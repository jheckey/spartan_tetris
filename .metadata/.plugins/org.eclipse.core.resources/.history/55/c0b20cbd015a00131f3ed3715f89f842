<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>~/Desktop/Lab2/Lab2b/src/lab2b.c.html</title>
<meta name="Generator" content="Vim/7.2">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#ffffff" text="#000000"><font face="monospace">
<font color="#ff0000">/*</font><font color="#ff0000">****************************************************************************</font><br>
<font color="#ff0000">* lab2a.c for Lab2A of ECE 153a at UCSB</font><br>
<font color="#ff0000">* Date of the Last Update:&nbsp;&nbsp;Aug 26, 2010</font><br>
<font color="#ff0000">****************************************************************************</font><font color="#ff0000">*/</font><br>
<br>
<font color="#a020f0">#define AO_LAB2A</font><br>
<br>
<font color="#a020f0">#include </font><font color="#ff00ff">&quot;qpn_port.h&quot;</font><br>
<font color="#a020f0">#include </font><font color="#ff00ff">&quot;bsp.h&quot;</font><br>
<font color="#a020f0">#include </font><font color="#ff00ff">&quot;lab2b.h&quot;</font><br>
<font color="#a020f0">#include </font><font color="#ff00ff">&quot;lcd.h&quot;</font><br>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;string.h&gt;</font><br>
<br>
<br>
<br>
<br>
<font color="#0000ff">typedef</font>&nbsp;<font color="#0000ff">struct</font>&nbsp;Lab2BTag&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#ff0000">//Lab2A State machine</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;QActive super;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">char</font>&nbsp;tmp[<font color="#ff00ff">9</font>];&nbsp;&nbsp; <font color="#ff0000">// Temp string for editing</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">char</font>&nbsp;str[<font color="#ff00ff">9</font>];&nbsp;&nbsp; <font color="#ff0000">// Saved string</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">char</font>&nbsp;cursor;&nbsp;&nbsp; <font color="#ff0000">// Cursor location - must be set to 0 when going to a new menu</font><br>
}&nbsp;&nbsp;Lab2B;<br>
<br>
<font color="#ff0000">/*</font><font color="#ff0000">&nbsp;Setup state machines </font><font color="#ff0000">*/</font><br>
<font color="#ff0000">/*</font><font color="#ff0000">********************************************************************</font><font color="#ff0000">*/</font><br>
<font color="#0000ff">static</font>&nbsp;QState Lab2B_initial (Lab2B *me);<br>
<font color="#0000ff">static</font>&nbsp;QState Lab2B_on&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Lab2B *me);<br>
<font color="#0000ff">static</font>&nbsp;QState MENU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Lab2B *me);<br>
<font color="#0000ff">static</font>&nbsp;QState DISPLAY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Lab2B *me);<br>
<font color="#0000ff">static</font>&nbsp;QState EDIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Lab2B *me);<br>
<font color="#0000ff">static</font>&nbsp;QState EDIT_LETTER&nbsp;&nbsp; (Lab2B *me);<br>
<br>
<font color="#ff0000">/*</font><font color="#ff0000">********************************************************************</font><font color="#ff0000">*/</font><br>
<br>
<br>
Lab2B AO_Lab2B;<br>
<br>
<br>
<font color="#0000ff">void</font>&nbsp;Lab2B_ctor(<font color="#0000ff">void</font>)&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Lab2B *me = &amp;AO_Lab2B;<br>
&nbsp;&nbsp;&nbsp;&nbsp;QActive_ctor(&amp;me-&gt;super, (QStateHandler)&amp;Lab2B_initial);<br>
&nbsp;&nbsp;&nbsp;&nbsp;strcpy(me-&gt;str, <font color="#ff00ff">&quot;&lt;none&gt;&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;strcpy(me-&gt;tmp, <font color="#ff00ff">&quot;AAAAAAAA&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;cursor = <font color="#ff00ff">0</font>;<br>
}<br>
<br>
<br>
<font color="#ff0000">/*</font><font color="#ff0000">&nbsp;Create Lab2B_on state and do any initialization code if needed </font><font color="#ff0000">*/</font><br>
<font color="#ff0000">/*</font><font color="#ff0000">****************************************************************</font><font color="#ff0000">*/</font><br>
<br>
QState Lab2B_initial(Lab2B *me) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;xil_printf(<font color="#ff00ff">&quot;</font><font color="#ff00ff">\n\r</font><font color="#ff00ff">Initialization&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;Lab2B_on);<br>
}<br>
<br>
QState Lab2B_on(Lab2B *me) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">switch</font>&nbsp;(Q_SIG(me)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;Q_ENTRY_SIG: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xil_printf(<font color="#ff00ff">&quot;</font><font color="#ff00ff">\n\r</font><font color="#ff00ff">On&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;Q_INIT_SIG: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;MENU);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_SUPER(&amp;QHsm_top);<br>
}<br>
<br>
QState MENU(Lab2B *me) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">//WriteString(&quot;MENU&quot;);</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">switch</font>&nbsp;(Q_SIG(me)){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;Q_ENTRY_SIG: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;cursor = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayClear();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayOnOff(<font color="#ff00ff">1</font>,<font color="#ff00ff">0</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteString(<font color="#ff00ff">&quot;EDIT&nbsp;&nbsp;&nbsp;&nbsp; DISPLAY&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_CLICK:&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>(!(me-&gt;cursor)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;EDIT);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">else</font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;DISPLAY);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_UP: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;cursor = (me-&gt;cursor + <font color="#ff00ff">1</font>) % <font color="#ff00ff">2</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">10</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_DOWN: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;cursor = (me-&gt;cursor - <font color="#ff00ff">1</font>) % <font color="#ff00ff">2</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">10</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_SUPER(&amp;Lab2B_on);<br>
}<br>
<br>
QState DISPLAY(Lab2B *me) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">switch</font>&nbsp;(Q_SIG(me)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;Q_ENTRY_SIG: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayClear();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayOnOff(<font color="#ff00ff">1</font>,<font color="#ff00ff">0</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteString(me-&gt;str);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteString(<font color="#ff00ff">&quot;Back&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a">case</font>&nbsp;ENCODER_CLICK:&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;MENU);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_UP: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_DOWN: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_SUPER(&amp;Lab2B_on);<br>
}<br>
<br>
<br>
QState EDIT(Lab2B *me) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">switch</font>&nbsp;(Q_SIG(me)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;Q_ENTRY_SIG: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;cursor = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(me-&gt;tmp, <font color="#ff00ff">&quot;AAAAAAAA&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayClear();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayOnOff(<font color="#ff00ff">1</font>,<font color="#ff00ff">0</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteString(<font color="#ff00ff">&quot;AAAAAAAA&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteString(<font color="#ff00ff">&quot;Back&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">13</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteString(<font color="#ff00ff">&quot;Save&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayOnOff(<font color="#ff00ff">1</font>,<font color="#ff00ff">0</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_UP: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// inc cursor position</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;cursor = (me-&gt;cursor + <font color="#ff00ff">1</font>) % <font color="#ff00ff">10</font>;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select character</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor &lt; <font color="#ff00ff">8</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,me-&gt;cursor+<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select Back</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">else</font>&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor == <font color="#ff00ff">8</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select Save</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">13</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_DOWN: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// inc cursor position</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;cursor = (me-&gt;cursor) ? (me-&gt;cursor - <font color="#ff00ff">1</font>) % <font color="#ff00ff">10</font>&nbsp;: <font color="#ff00ff">9</font>;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select character</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor &lt; <font color="#ff00ff">8</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,me-&gt;cursor+<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select Back</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">else</font>&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor == <font color="#ff00ff">8</font>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select Save</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">else</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">2</font>,<font color="#ff00ff">13</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_CLICK: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select character</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor &lt; <font color="#ff00ff">8</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;EDIT_LETTER);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select Back</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a">else</font>&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;cursor == <font color="#ff00ff">8</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_leds(<font color="#ff00ff">0xCC</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;MENU);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// Select Save</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a">else</font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_leds(<font color="#ff00ff">0xff</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(me-&gt;str, me-&gt;tmp);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;MENU);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_SUPER(&amp;Lab2B_on);<br>
}<br>
<br>
QState EDIT_LETTER (Lab2B *me) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">switch</font>&nbsp;(Q_SIG(me)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;Q_ENTRY_SIG: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayOnOff(<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>,<font color="#ff00ff">0</font>);&nbsp;&nbsp;<font color="#ff0000">// Turn off blinking, but add the line to show what is changing</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,me-&gt;cursor+<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;Q_EXIT_SIG: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DisplayOnOff(<font color="#ff00ff">1</font>,<font color="#ff00ff">0</font>,<font color="#ff00ff">1</font>);&nbsp;&nbsp;<font color="#ff0000">// Turn blinking back on</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_UP: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>&nbsp;( (me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &gt;= <font color="#ff00ff">'A'</font>&nbsp;&amp;&amp; me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &lt; <font color="#ff00ff">'Z'</font>) ||<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &gt;= <font color="#ff00ff">'0'</font>&nbsp;&amp;&amp; me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &lt; <font color="#ff00ff">'9'</font>) ) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor]++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a">else</font>&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] == <font color="#ff00ff">'Z'</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] = <font color="#ff00ff">'0'</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a">else</font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// '9' or anything else - go to 'A'</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] = <font color="#ff00ff">'A'</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PutChar(me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,me-&gt;cursor+<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_DOWN: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">if</font>&nbsp;( (me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &gt; <font color="#ff00ff">'A'</font>&nbsp;&amp;&amp; me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &lt;= <font color="#ff00ff">'Z'</font>) ||<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &gt; <font color="#ff00ff">'0'</font>&nbsp;&amp;&amp; me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] &lt;= <font color="#ff00ff">'9'</font>) ) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor]--;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a">else</font>&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] == <font color="#ff00ff">'A'</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] = <font color="#ff00ff">'9'</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a">else</font>&nbsp;<font color="#a52a2a">if</font>&nbsp;(me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] == <font color="#ff00ff">'0'</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] = <font color="#ff00ff">'Z'</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a">else</font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">// anything else - go to 'A'</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor] = <font color="#ff00ff">'A'</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PutChar(me-&gt;tmp[(<font color="#0000ff">int</font>)me-&gt;cursor]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCursor(<font color="#ff00ff">1</font>,me-&gt;cursor+<font color="#ff00ff">1</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_HANDLED();<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">case</font>&nbsp;ENCODER_CLICK: {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_TRAN(&amp;EDIT);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a">return</font>&nbsp;Q_SUPER(&amp;EDIT);<br>
}<br>
<br>
</font></body>
</html>
